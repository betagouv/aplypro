
.fr-table.fr-table--no-caption
  %table
    %caption= caption
    %thead
      %th{scope: "col"}
        Élèves
        = "(#{schoolings.count})"
      %th{scole: "col"}
        .fr-grid-row
          .fr-mr-1w Décisions d'attribution
          = attributive_decisions_progress_badge(schoolings)
      %th{scope: "col"}
        .fr-grid-row
          .fr-mr-1w Coordonnées bancaires
          = ribs_progress_badge(schoolings)
      %th{scope: "col"}
        PFMPs
        = "(#{nb_pfmps(schoolings)})"

    %tbody
      - schoolings.each do |schooling|
        - student = schooling.student
        %tr
          %td
            = dsfr_link_to student.index_name, student_path(student), title: t("links.students.show", name: student)
          %td
            - if schooling.attributive_decision.present? && !schooling.abrogation_decision.present?
              %p= dsfr_badge(status: :success) { "Éditée" }
              - if schooling.closed?
                = dsfr_link_to "Abroger", confirm_abrogation_school_year_class_schooling_path(selected_school_year, @classe, schooling)
            - else
              - if schooling.abrogation_decision.present?
                = dsfr_badge(status: :error) { "Abrogée" }
              - else
                = dsfr_badge(status: :error) { "Manquante" }
              - if schooling.attributive_decision.present? && schooling.end_date.present?
                %p= dsfr_link_to "Autoriser un report", confirm_da_extension_school_year_class_schooling_path(selected_school_year, @classe, schooling)
              - elsif schooling.extended_end_date.present?
                = dsfr_badge(status: :info) { "Reportée" }
                %p= dsfr_link_to "Annuler le report", confirm_da_extension_school_year_class_schooling_path(selected_school_year, @classe, schooling)
          %td
            - if student.rib.present?
              %p= dsfr_badge(status: :success) { "Saisies" }
              = dsfr_link_to "Modifier les coordonnées bancaires", edit_student_rib_path(student, student.rib)
            - else
              %p= dsfr_badge(status: :error) { "Non saisies" }
              = dsfr_link_to "Saisir les coordonnées bancaires", new_student_rib_path(student)
          %td
            %ul
              - schooling.pfmps.each do |pfmp|
                %li= dsfr_link_to pfmp.listing_to_s, school_year_class_schooling_pfmp_path(selected_school_year, @classe, schooling, pfmp), title: pfmp.full_dates
              %li= dsfr_link_to "Ajouter une PFMP individuelle", new_school_year_class_schooling_pfmp_path(selected_school_year, @classe, schooling)
