.fr-col-md-6
  .fr-mb-3w
    .fr-mb-2w= render partial: "pfmp_badges"

    %p
      %em= t("pfmps.state_explanations.#{@pfmp.current_state}").html_safe
    %p
      %strong PFMP du #{l @pfmp.start_date} au #{l @pfmp.end_date}

    %p
      - if @pfmp.in_state?(:pending)
        = dsfr_link_to "Nombre de jours à compléter", edit_class_schooling_pfmp_path(@classe, @schooling, @pfmp)
      - else
        %strong
          = @pfmp.day_count
          jours
        travaillés

    .fr-btns-group.fr-btns-group--inline
      - if @pfmp.in_state?(:completed) and current_user.can_validate?
        = button_to "Valider", validate_class_schooling_pfmp_path(@classe, @schooling, @pfmp), class: 'fr-btn'
      - if @pfmp.can_be_modified?
        = link_to "Modifier la PFMP", edit_class_schooling_pfmp_path(@classe, @schooling, @pfmp), class: 'fr-btn fr-btn--secondary'
        = link_to "Supprimer la PFMP", confirm_deletion_class_schooling_pfmp_path(@classe, @schooling, @pfmp), class: 'fr-btn fr-btn--secondary'
      - else
        = button_tag "Modifier la PFMP", disabled: true, class: 'fr-btn fr-btn--secondary', title: "Vous ne pouvez pas modifier une PFMP dont le paiement est en cours de traitement"
        = button_tag "Supprimer la PFMP", disabled: true, class: 'fr-btn fr-btn--secondary', title: "Vous ne pouvez pas supprimer une PFMP dont le paiement est en cours de traitement"


  - if @pfmp.payment_due?
    %h2.fr-h3 Paiement
    .gray-panel.fr-p-3w.fr-mb-3w
      %div
        .fr-h4
          = number_to_currency @pfmp.amount
          à payer
      %div
        = @pfmp.day_count
        jours x
        = number_to_currency @pfmp.wage.daily_rate
        par jour =
        = number_to_currency(@pfmp.day_count * @pfmp.wage.daily_rate)
      %div
        = number_to_currency @pfmp.wage.yearly_cap
        de plafond maximum par an
      %div.fr-mb-1w
        = number_to_currency @pfmp.previously_locked_amount
        engagés par les PFMPs précédemment déclarées.

  - if @pfmp.in_state?(:validated)
    %h3.fr-h5
      = "Demande".pluralize(@pfmp.payment_requests.count)
      de paiement

    - @pfmp.payment_requests.order(updated_at: :desc).each do |payment_request|
      .gray-panel.fr-p-3w.fr-mb-3w
        = render partial: "payment_requests/badges", locals: { payment_request: payment_request }
        .fr-mt-1w
          %em= t("payment_requests.state_explanations.#{payment_request.current_state}", **payment_request.status_explanation_args).html_safe

        .fr-mt-2w.gray-text
          Dernière mise à jour le
          = l(payment_request.updated_at, format: :long)
