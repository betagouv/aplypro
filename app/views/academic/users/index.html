<div class="container">
  <h1>Directeurs confirmés - <%= selected_academy %></h1>

  <div class="table-responsive">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Email</th>
          <th>Établissement(s)</th>
          <th>Nombre d'établissements</th>
          <th>Dernière connexion</th>
        </tr>
      </thead>
      <tbody>
        <% @users.each do |user| %>
          <tr>
            <td><%= user.name %></td>
            <td><%= user.email %></td>
            <td>
              <% user.confirmed_establishments.where(academy_code: selected_academy).each do |establishment| %>
                <div>
                  <%= establishment.name %>
                  <small class="text-muted">(<%= establishment.uai %>)</small>
                </div>
              <% end %>
            </td>
            <td>
              <span class="badge bg-primary">
                <%= user.confirmed_establishments.where(academy_code: selected_academy).count %>
              </span>
            </td>
            <td>
              <%= user.last_sign_in_at&.strftime("%d/%m/%Y %H:%M") || "Jamais connecté" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% if @users.empty? %>
    <div class="alert alert-info">
      Aucun directeur confirmé trouvé pour cette académie.
    </div>
  <% end %>

  <div class="d-flex justify-content-center">
    <%= paginate @users %>
  </div>
</div>
